# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/Fix the following issues. The issues can be from different files or can overlap on same lines in one file.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/publish at line 34, The command uses $(basename $0) without quoting $0 which can break if the script name contains spaces or special characters; update the invocation to quote the positional parameter—use $(basename "$0") wherever $(basename $0) appears (e.g., in the --exclude argument) so the script name is safely handled.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/publish at line 11, The version detection uses `version=$(git tag -l | tail -1)` which picks the lexicographically last tag and can return empty; replace it with a version lookup that sorts tags by semantic/version order (e.g., use `git tag --sort=-v:refname` or `git tag --sort=-v:refname --list` and take the first, or use `git describe --tags --abbrev=0`) and add a check for an empty result to fail fast or provide a sensible default; update the assignment referencing the `version` variable and ensure subsequent logic handles the missing/empty version case (abort with an informative error message if no tags found).

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/spec/ev_common_spec.lua around lines 72 - 76, The test's on_sent callback references an undefined variable err; update the callback signature for on_sent (the async(function...)) to accept the error parameter (e.g., function(err, buf) or function(err)) and then assert.is_nil(err, 'should not happen') instead of asserting on an undefined err, ensuring the error argument passed by the sender is checked correctly.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/spec/handshake_spec.lua at line 1, The package.path concatenation is missing the path separator; update the assignment package.path = package.path..'../src' to include a semicolon separator (e.g., package.path = package.path..';../src') so the new entry is correctly separated from existing paths, matching the fix applied in tools_spec.lua.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/spec/tools_spec.lua at line 1, The assignment to package.path is missing the required semicolon separator; update the concatenation so the existing package.path and the new '../src' entry are separated by ';' (e.g. change package.path = package.path..'../src' to package.path = package.path .. ';' .. '../src') so Lua can recognize the new path entry.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/src/websocket/client_sync.lua around lines 29 - 32, The sock_close function calls self.sock:shutdown() and self.sock:close() without checking self.sock, causing errors when the socket is nil (e.g., on failed connect or duplicate calls); update the sock_close implementation to first return early if self.sock is nil, otherwise call shutdown and close, and then nil out self.sock (and optionally guard each method call) so repeated calls are safe and no nil dereference occurs.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/src/websocket/ev_common.lua at line 153, Fix the typo in the inline comment: replace "the might be already data waiting (which will not trigger the IO)" with "there might be already data waiting (which will not trigger the IO)" in ev_common.lua (the comment near the websocket/ev_common.lua code block that describes potential already-waiting data).

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/src/websocket/frame.lua around lines 135 - 137, The payload length check in websocket/frame.lua uses an off-by-one: update the conditional that currently reads "if payload < 0xffff or payload > 2^53 then" to require that 8-byte length encoding is used only when payload >= 0x10000 (65536) by changing the lower bound to 0x10000 (i.e., "if payload < 0x10000 or payload > 2^53 then"), keeping the upper 2^53 guard intact and leaving the assert call (assert(false,'INVALID PAYLOAD '..payload)) as-is.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/src/websocket/server_ev.lua around lines 230 - 236, The on_error call passes only the error string but the handler expects signature (s, err); update the invocation in server_ev.lua to call on_error with the socket and error message (e.g., on_error(client_sock, 'bad protocol')) so it matches the (s, err) parameters; locate the call near the else branch that currently does client_sock:close() and replace the single-arg call to include client_sock.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/src/websocket/sync.lua around lines 89 - 95, In the close function, the check "if self.state ~= 'OPEN' then return false,1006,'wrong state'" makes the subsequent "if self.state == 'CLOSED' then ..." unreachable; fix by replacing the two overlapping conditions with explicit state handling: first test if self.state == 'OPEN' to proceed, else if self.state == 'CLOSED' return the CLOSED-specific tuple, else return the generic wrong-state tuple—update the function around the self.state checks in close to follow that clear branching.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/test-server/index.html around lines 335 - 342, The code creates implicit global variables by assigning offsetX = offsetY = 0 and element = canvas without declarations; change these to properly declared local variables (e.g., use let or const) so offsetX, offsetY and element are not globals—declare something like let offsetX = 0, offsetY = 0 and let element = canvas before the offsetParent loop to fix the issue.

- In @sdk/laixi_wsapi_test/Lua/lua/lua-websockets/test-server/test-server-ev.lua around lines 44 - 46, The code uses io.popen('pwd') inline which leaves the process handle open; change to capture the handle in a local variable (e.g., pwdHandle = io.popen('pwd')), read the output from that handle, then call pwdHandle:close() before concatenating into the file:// path (the print lines around io.popen and the surrounding code that calls loop:loop() should remain unchanged).

- 

- In @sdk/laixi_wsapi_test/Lua/lua/wsapi.lua around lines 19 - 22, The snippet reads from the WebSocket but never closes it and calls ws_client:sock_receive() without using its return; update the code to explicitly close the socket by calling ws_client:close() after the receive/processing and either remove the unnecessary ws_client:sock_receive() call or capture and handle its return value (e.g., check for nil/error or use the returned message) so there is no resource leak and the sock_receive() purpose is clear; refer to ws_client:receive, ws_client:sock_receive, and ws_client:close when making the change.

- In @sdk/laixi_wsapi_test/Node/node/laixi.js around lines 7 - 16, The function toastMsg currently ignores its msg parameter and always sets a hardcoded message; update the JSON returned by module.exports.toastMsg so the "content" field uses the msg argument (keeping the default value "这是来喜弹出的一个Toast提示") instead of the hardcoded string, ensuring deviceIds still uses the deviceIds parameter and the exported function signature (toastMsg) remains unchanged.

- In @sdk/laixi_wsapi_test/Node/node/laixi.js around lines 24 - 32, The launchApp function concatenates the appName directly into a shell command causing command injection; validate and sanitize appName in launchApp: ensure it matches a strict package-name pattern (e.g. only letters, numbers, dots and underscores) or reject otherwise, and construct the command safely (avoid string concatenation into shell where possible) — reference the function launchApp and the "command" value so you modify the generation to only accept a validated appName (or escape/quote it and/or pass arguments as structured data instead of embedding raw input).

- In @sdk/laixi_wsapi_test/Node/node/package.json around lines 11 - 13, Update the "ws" dependency in package.json to a non-vulnerable version by changing the version specifier for "ws" from "^8.13.0" to at least ">=8.17.1" (preferably "8.18.3"); this fixes CVE-2024-37890 — ensure package.json's "dependencies" entry for "ws" is updated and then run npm install / yarn install and lockfile update to persist the upgrade.

- In @sdk/laixi_wsapi_test/Python/python/laixi.py around lines 59 - 66, listKeywordPackages concatenates the user-provided keyword directly into a shell command, enabling command injection; fix it by either validating/whitelisting the keyword (e.g., allow only alphanumerics, hyphen, underscore) before use or by escaping it with a safe shell-quoting routine (e.g., use shlex.quote) and avoid inline pipes; update the listKeywordPackages function to validate or safely quote the keyword parameter and/or move filtering off the shell (call "pm list packages" and filter in Python) so no untrusted input is injected into the grep command.

- In @sdk/laixi_wsapi_test/Python/python/wsapi.py around lines 6 - 12, The async command function uses an infinite while True to recv messages without any exit or error handling; change it to loop with a clear exit and exception handling: wrap await websocket.recv() in try/except catching websockets.exceptions.ConnectionClosed and other exceptions to break the loop, optionally break when recv_text is a predefined sentinel (e.g., "CLOSE" or empty) or when a parsed message indicates termination, and ensure you close the websocket in a finally block (references: function command, variables url, cmdStr, websocket, recv_text).

- In @supabase/functions/wormhole-detector/index.ts around lines 162 - 163, Validate activity.timestamp before creating dates: when constructing now = new Date(activity.timestamp) check that the resulting date is valid (e.g., Number.isFinite(now.getTime()) or !isNaN(now.getTime())); if invalid, handle gracefully (log the bad timestamp and skip processing this activity or throw a controlled error) instead of using it to compute windowStart with WORMHOLE_CONFIG.TIME_WINDOW_MS; update the code around now and windowStart to perform this validation and early return/skip path.

- 

- In @supabase/migrations/20260105_umbra_wormhole_v2.sql around lines 13 - 33, The script drops and recreates the node_status enum which can break dependent objects and fail if existing rows contain values not present in the new enum; instead modify node_status in-place by adding new labels with ALTER TYPE ... ADD VALUE IF NOT EXISTS and avoid DROP TYPE; update the migration to call ALTER TYPE node_status ADD VALUE IF NOT EXISTS 'in_umbra' and 'maintenance' (handling duplicate_object exceptions if necessary), and only convert columns or cast types after ensuring all existing column values are valid members of node_status on the nodes table.

- In @supabase/migrations/20260107_wss_protocol_v1.sql around lines 401 - 422, The function disconnect_node currently returns FOUND which reflects only the last UPDATE (command_queue) and can be FALSE when the node row was updated but no commands needed reassignment; modify disconnect_node to return whether the node UPDATE affected any rows: declare an integer (e.g., node_rows), run the UPDATE nodes as-is, immediately capture its affected row count with GET DIAGNOSTICS node_rows = ROW_COUNT, then run the command_queue UPDATE, and finally RETURN (node_rows > 0) so the function indicates whether the node existed/was updated.
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
.venv/
venv/
ENV/
env/

# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# Build outputs
frontend/dist/
frontend/build/
*.local

# TypeScript incremental build artifacts
*.tsbuildinfo
**/*.tsbuildinfo

# Environment
.env
.env.local
.env.*.local

# IDE
.idea/
.vscode/
*.swp
*.swo
*~
.DS_Store

# Visual Studio user-specific files
*.user
*.suo
*.userosscache
*.sln.docstates

# Logs
logs/
*.log

# Database
*.db
*.sqlite
*.sqlite3

# Docker
.docker/

# Temporary
tmp/
temp/
*.tmp

# Screenshots
screenshots/
*.png
*.jpg
*.jpeg

# OS
Thumbs.db
ehthumbs.db

# Claude local settings (contains sensitive paths/IPs)
.claude/settings.local.json

# Deployment files with sensitive data
deploy/deploy_to_vultr.bat
deploy/deploy.env